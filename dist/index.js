import{createRequire as At} from"node:module";var ht=Object.create;var{defineProperty:pe,getPrototypeOf:wt,getOwnPropertyNames:Tt}=Object;var Ct=Object.prototype.hasOwnProperty;var Mt=(e,t,n)=>{n=e!=null?ht(wt(e)):{};const r=t||!e||!e.__esModule?pe(n,"default",{value:e,enumerable:!0}):n;for(let o of Tt(e))if(!Ct.call(r,o))pe(r,o,{get:()=>e[o],enumerable:!0});return r};var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var q=At(import.meta.url);var X=g((ue)=>{var bt=function(e){return e&&e.__esModule?e:{default:e}},Gt=function(){if(V>K.length-16)_t.default.randomFillSync(K),V=0;return K.slice(V,V+=16)};Object.defineProperty(ue,"__esModule",{value:!0});ue.default=Gt;var _t=bt(q("crypto")),K=new Uint8Array(256),V=K.length});var fe=g((ce)=>{Object.defineProperty(ce,"__esModule",{value:!0});ce.default=void 0;var qt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ce.default=qt});var b=g((xe)=>{var Kt=function(e){return e&&e.__esModule?e:{default:e}},Ut=function(e){return typeof e==="string"&&Vt.default.test(e)};Object.defineProperty(xe,"__esModule",{value:!0});xe.default=void 0;var Vt=Kt(fe()),Lt=Ut;xe.default=Lt});var G=g((ge)=>{var Zt=function(e){return e&&e.__esModule?e:{default:e}},me=function(e,t=0){return m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]},Bt=function(e,t=0){const n=me(e,t);if(!Wt.default(n))throw TypeError("Stringified UUID is invalid");return n};Object.defineProperty(ge,"__esModule",{value:!0});ge.default=void 0;ge.unsafeStringify=me;var Wt=Zt(b()),m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));var zt=Bt;ge.default=zt});var Pe=g((Fe)=>{var Ht=function(e){return e&&e.__esModule?e:{default:e}},jt=function(e,t,n){let r=t&&n||0;const o=t||new Array(16);e=e||{};let i=e.node||Oe,d=e.clockseq!==void 0?e.clockseq:Y;if(i==null||d==null){const l=e.random||(e.rng||Xt.default)();if(i==null)i=Oe=[l[0]|1,l[1],l[2],l[3],l[4],l[5]];if(d==null)d=Y=(l[6]<<8|l[7])&16383}let s=e.msecs!==void 0?e.msecs:Date.now(),p=e.nsecs!==void 0?e.nsecs:j+1;const a=s-H+(p-j)/1e4;if(a<0&&e.clockseq===void 0)d=d+1&16383;if((a<0||s>H)&&e.nsecs===void 0)p=0;if(p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");H=s,j=p,Y=d,s+=12219292800000;const u=((s&268435455)*1e4+p)%4294967296;o[r++]=u>>>24&255,o[r++]=u>>>16&255,o[r++]=u>>>8&255,o[r++]=u&255;const c=s/4294967296*1e4&268435455;o[r++]=c>>>8&255,o[r++]=c&255,o[r++]=c>>>24&15|16,o[r++]=c>>>16&255,o[r++]=d>>>8|128,o[r++]=d&255;for(let l=0;l<6;++l)o[r+l]=i[l];return t||Yt.unsafeStringify(o)};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.default=void 0;var Xt=Ht(X()),Yt=G(),Oe,Y,H=0,j=0,en=jt;Fe.default=en});var ee=g((ke)=>{var nn=function(e){return e&&e.__esModule?e:{default:e}},rn=function(e){if(!tn.default(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=t&255,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=t&255,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=t&255,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=t&255,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=t&255,n};Object.defineProperty(ke,"__esModule",{value:!0});ke.default=void 0;var tn=nn(b()),on=rn;ke.default=on});var te=g((Ie)=>{var pn=function(e){return e&&e.__esModule?e:{default:e}},an=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},un=function(e,t,n){function r(o,i,d,s){var p;if(typeof o==="string")o=an(o);if(typeof i==="string")i=dn.default(i);if(((p=i)===null||p===void 0?void 0:p.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+o.length);if(a.set(i),a.set(o,i.length),a=n(a),a[6]=a[6]&15|t,a[8]=a[8]&63|128,d){s=s||0;for(let u=0;u<16;++u)d[s+u]=a[u];return d}return sn.unsafeStringify(a)}try{r.name=e}catch(o){}return r.DNS=Re,r.URL=$e,r};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.URL=Ie.DNS=void 0;Ie.default=un;var sn=G(),dn=pn(ee()),Re="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Ie.DNS=Re;var $e="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Ie.URL=$e});var we=g((Se)=>{var xn=function(e){return e&&e.__esModule?e:{default:e}},yn=function(e){if(Array.isArray(e))e=Buffer.from(e);else if(typeof e==="string")e=Buffer.from(e,"utf8");return fn.default.createHash("md5").update(e).digest()};Object.defineProperty(Se,"__esModule",{value:!0});Se.default=void 0;var fn=xn(q("crypto")),mn=yn;Se.default=mn});var Ae=g((Ce)=>{var Te=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.default=void 0;var gn=Te(te()),Nn=Te(we()),On=gn.default("v3",48,Nn.default),Fn=On;Ce.default=Fn});var Ge=g((_e)=>{var Pn=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_e,"__esModule",{value:!0});_e.default=void 0;var Dn=Pn(q("crypto")),kn={randomUUID:Dn.default.randomUUID};_e.default=kn});var Ue=g((Ve)=>{var qe=function(e){return e&&e.__esModule?e:{default:e}},$n=function(e,t,n){if(Qe.default.randomUUID&&!t&&!e)return Qe.default.randomUUID();e=e||{};const r=e.random||(e.rng||En.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let o=0;o<16;++o)t[n+o]=r[o];return t}return Rn.unsafeStringify(r)};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.default=void 0;var Qe=qe(Ge()),En=qe(X()),Rn=G(),In=$n;Ve.default=In});var Ze=g((Le)=>{var Sn=function(e){return e&&e.__esModule?e:{default:e}},hn=function(e){if(Array.isArray(e))e=Buffer.from(e);else if(typeof e==="string")e=Buffer.from(e,"utf8");return vn.default.createHash("sha1").update(e).digest()};Object.defineProperty(Le,"__esModule",{value:!0});Le.default=void 0;var vn=Sn(q("crypto")),wn=hn;Le.default=wn});var Xe=g((ze)=>{var Be=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ze,"__esModule",{value:!0});ze.default=void 0;var Tn=Be(te()),Cn=Be(Ze()),Mn=Tn.default("v5",80,Cn.default),An=Mn;ze.default=An});var je=g((Ye)=>{Object.defineProperty(Ye,"__esModule",{value:!0});Ye.default=void 0;var _n="00000000-0000-0000-0000-000000000000";Ye.default=_n});var nt=g((et)=>{var Gn=function(e){return e&&e.__esModule?e:{default:e}},Qn=function(e){if(!bn.default(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)};Object.defineProperty(et,"__esModule",{value:!0});et.default=void 0;var bn=Gn(b()),qn=Qn;et.default=qn});var rt=g((F)=>{var P=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(F,"__esModule",{value:!0});Object.defineProperty(F,"NIL",{enumerable:!0,get:function(){return Wn.default}});Object.defineProperty(F,"parse",{enumerable:!0,get:function(){return Jn.default}});Object.defineProperty(F,"stringify",{enumerable:!0,get:function(){return zn.default}});Object.defineProperty(F,"v1",{enumerable:!0,get:function(){return Vn.default}});Object.defineProperty(F,"v3",{enumerable:!0,get:function(){return Kn.default}});Object.defineProperty(F,"v4",{enumerable:!0,get:function(){return Un.default}});Object.defineProperty(F,"v5",{enumerable:!0,get:function(){return Ln.default}});Object.defineProperty(F,"validate",{enumerable:!0,get:function(){return Bn.default}});Object.defineProperty(F,"version",{enumerable:!0,get:function(){return Zn.default}});var Vn=P(Pe()),Kn=P(Ae()),Un=P(Ue()),Ln=P(Xe()),Wn=P(je()),Zn=P(nt()),Bn=P(b()),zn=P(G()),Jn=P(ee())});function pr(e){return new ae(e)}function ar(e){return e.reduce((t,n)=>{return{...t,[n+""]:n}},{})}class ae{e;constructor(e){this.opts=e}}var O;(function(s){s["STRING"]="string";s["INT"]="int";s["FLOAT"]="float";s["BOOL"]="bool";s["GEO"]="geo";s["DATETIME"]="dateTime";s["PASSWORD"]="password"})(O||(O={}));var ur=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];var D=Mt(rt(),1),vr=D.default.v1,Sr=D.default.v3,ne=D.default.v4,hr=D.default.v5,wr=D.default.NIL,Tr=D.default.version,Cr=D.default.validate,Mr=D.default.stringify,Ar=D.default.parse;var S={eq:{alias:"Equal",fields:1}},Q={le:{alias:"Less than or equal to",fields:1},ge:{alias:"Greater than or equal to",fields:1},lt:{alias:"Less than",fields:1},gt:{alias:"Greater than",fields:1}},ot={between:{alias:"Between the values",fields:2}},it={allofterms:{alias:"All of the terms in",fields:1},anyofterms:{alias:"Any of the terms in",fields:1}},st={alloftext:{alias:"Any of the text in",fields:1},anyoftext:{alias:"Any of the text in",fields:1}},dt={regexp:{alias:"Like",fields:1}},pt={match:{alias:"Similar to",alias2:"with similarity of",fields:2}},at={within:{alias:"Within",fields:1},contains:{alias:"Contained within",fields:1},intersects:{alias:"Intersecting among",fields:1}},ut={near:{alias:"Near the values",fields:2}},ct={has:{alias:"Has the property",fields:0},uid:{alias:"Has the ID",fields:0},type:{alias:"Is the type",fields:0}},lt={uid_in:{alias:"Has UID in",fields:1}},w={...ct,...lt},k={hash:S,exact:{...S,...Q,...ot},term:{...S,...Q,...it},fulltext:{...st},trigram:{...S,...dt,...pt}},ft={year:k.exact,month:k.exact,day:k.exact,hour:k.exact},xt={...k.exact,...at,...ut},yt={...k.exact},Xn={...ut,...ot,...pt},Yn={...S,...Q,...it,...st,...dt,...at,...lt},Hn={...ct},mt={...Yn,...Xn,...Hn};function gt(e,t,n){if(!(e.op in mt))throw new Error("Cannot do filter if operator is not a func");if("value"in e){if(!e.value)return}if("values"in e){if(!e.values||!e.values[0]||!e.values[1])return}if(e.op==="uid"){const o=E(e.value,t,n);return`${e.op}(${o})`}if(e.op==="has"||e.op==="type"){if(!n.has(e.value))throw Error("Cannot parse the filter value because it may not be safe.");return`${e.op}(${e.value})`}if(!("field"in e)||!n.has(e.field))throw new Error(`Cannot parse ${String("field"in e?e.field:"current filter field")} because the field is either undefined or is unsafe`);if("values"in e){const o=E(e.values[0],t,n),i=E(e.values[1],t,n);return`${e.op}(${e.field}, ${o}, ${i})`}let r=E(e.value,t,n);if(n.has(r)&&e.wrap)r=`${e.wrap}(${r})`;return`${e.op}(${e.field}, ${r})`}function E(e,t,n){const r=typeof e==="string"&&n.has(e)?e:jn(t);if(r!==e)t.set(r,e);return r}var jn=function(e){let t=`\$f${ne().split("-")[0]}`;while(e.has(t))t=`\$f${ne().split("-")[0]}`;return t};function R({cascade:e,filter:t,order:n,page:r},o,i){const d=re(t,o,i),s=er(e,i),p=Ot(n,i),a=Nt(r,o,i);return[d?`@filter(${d})`:void 0,p?`(${p})`:void 0,a?`(${a})`:void 0,s].filter((c)=>!!c).join(" ")}function U({mainFunc:e,order:t,page:n},r,o){const i=re(e,r,o);if(!i)throw Error("Cannot query without main function");const d=[`func: ${i}`];return d.push(Ot(t,o)),d.push(Nt(n,r,o)),d.filter((s)=>!!s).join(", ")}function er(e,t){if(typeof e==="boolean")return"@cascade";if(typeof e==="string"&&t.has(e))return"@cascade"+`(${e})`;return}function re(e,t,n){if(!e)return;if("connector"in e){const o=e.values.map((d)=>re(d,t,n)).filter((d)=>!!d);if(!o.length)return;const i=o.join(` ${e.connector.toUpperCase()} `);if(o.length>1)return e.not?`NOT(${i})`:`(${i})`;return i}const r=gt(e,t,n);if(!r)return;return e.not?`NOT(${r})`:r}function Nt(e,t,n){if(!e)return;const r=[];if("limit"in e)r.push(`first: ${E(e.limit,t,n)}`);if("offset"in e)r.push(`offset: ${E(e.offset,t,n)}`);if("after"in e)r.push(`after: ${E(e.after,t,n)}`);return r.filter((o)=>!!o).join(", ")}function Ot(e,t){if(!e)return;const n=[];for(let r of e){if(!r||!t.has(r.field))continue;n.push(`order${r.format??"asc"}: ${r.field}`)}return n.join(", ")}function $(e,t){const n=e?`${e} as `:" ";if(e&&t)t.add(e);return n}function N(e){return Array.from({length:e}).map(()=>"  ").join("")}function T(e,t,n,r,o,i,d=1){const s=N(d);if(typeof r==="boolean")return`${s}${e}: ${n.name}.${e}`;if(t.opts.type===O.PASSWORD&&typeof r==="object"&&"pwdVar"in r){const{alias:c,asVar:l,pwdVar:x}=r,f=`checkpwd(${n.name}.${e}, ${x})`;o.set(x,void 0);const y=$(l,i);return`${s}${c??e}:${y}${f}`}if(typeof r==="boolean")return`${s}${e}: ${n.name}.${e}`;const{alias:p,asVar:a}=r,u=$(a,i);return`${s}${p??e}: ${u}${n.name}.${e}`}function C(e,t,n,r=1){const o=tr(e),i=N(r);if(typeof t==="boolean")return`${i}${e}: ${o}`;const{alias:d,asVar:s}=t,p=$(s,n);return`${i}${d??e}:${p}${o}`}function M(e,t,n,r=1){const o=N(r),{alias:i,asVar:d}=t,s=$(d,n);return`${o}${i??e}:${s}count(uid)`}function tr(e){if(e==="uid")return"uid";else return"dgraph.type"}function oe(e,t,n,r,o,i,d=1){const s=N(d),{cascade:p,filter:a,opts:u,order:c,page:l,predicates:x}=r,f=L(e,t,n,i,u?.alias,u?.asVar),y=R({cascade:p,page:l,filter:a,order:c},o,i),I=W(t.nextNode,x,o,i,d+1);return`${s}${f} ${y} {\n${I}\n${s}}`}function Ft(e,t,n){const r=e.name,{relation:o}=t;let i;if("forward"in o)i=`${r}.${n}`;else i=`~${t.nextNode.name}.${o.predName}`;return i}function L(e,t,n,r,o,i){let d=Ft(e,t,n);if(i)d=`${$(i,r)}${d}`;return`${o??n}: ${d}`}function A(e,t,n,r,o,i=1){const d=N(i),{alias:s,asVar:p}=r,a=$(p,o),u=Ft(e,t,n);return`${d}${s??n}:${a}count(${u})`}function W(e,t,n,r,o=2){const i=e.getPredToNode(),d=[];for(let s in t){const p=t[s];if(!p)continue;if(s==="dExtend"){const x=p;d.push(x.fragmentStr??x.build());for(let[f,y]of x.usedVars)n.set(f,y);continue}if(s==="uid"||s==="dtype"){let x;if(p instanceof Array)x=p.map((f)=>{if(typeof f==="object"&&"asCount"in f)return M("uid",f,r,o);return C(s,f,r,o)}).join("\n");else if(typeof p==="object"&&"asCount"in p)x=M("uid",p,r,o);else x=C(s,p,r,o);d.push(x);continue}const a=i[s],c=a.extendedPredicates[s];if(typeof c==="function"){const x=c();for(let y of x.nextNode.getAllowedValues())r.add(y);let f;if(p instanceof Array)f=p.map((y)=>{if(typeof y==="object"&&"asCount"in y)return A(a,x,s,y,r,o);return oe(a,x,s,y,n,r,o)}).join("\n");else if(typeof p==="object"&&"asCount"in p)f=A(a,x,s,p,r,o);else f=oe(a,x,s,p,n,r,o);d.push(f);continue}let l;if(p instanceof Array)l=p.map((x)=>T(s,c,a,x,n,r,o)).join("\n");else l=T(s,c,a,p,n,r,o);d.push(l)}return d.join("\n")}function no(e,t,n={allowedValues:new Set},r=!0){const{allowedValues:o}=n,i=new Map,d=new Set([...e.getAllowedValues(),...e.typeNames,...o]);function s(){return W(e,t,i,d,2)}return{build:s,fragment:t,type:void 0,fragmentStr:r?s():void 0,usedVars:i,allowedValues:d}}function ro(e,...t){return t}function Dt(e,t,n=!1){const r=e.getPredToNode(),o={};for(let i in t){const d=t[i],s=r[i];if(i==="dtype"){o["dgraph.type"]=d;continue}if(i==="uid"){o.uid=d;continue}if(d===void 0)continue;const p=`${s.name}.${i}`,a=s.predicates[i];if(typeof a==="function"){const u=a();let c;if(d instanceof Array)c=d.map((l)=>Dt(u.nextNode,l));else if(d===void 0||d===null)c=d;else c=Dt(u.nextNode,d);o[p]=c;continue}o[p]=d}if(!("dtype"in t)&&!n)o["dgraph.type"]=e.typeNames;return o}function Pt(e){const t={};for(let n of e){const r=n.predicates;for(let o in r)t[o]=n}return t}function ie(e){let t=[];for(let n of e)if(t=[...t,n],"_extendedPredicates"in n){t=t.concat(ie(n.extendedNodes()));continue}return t}function co(e,t){return new se(e,t)}class se{e;t;_predToNode;allowedValues=new Set;constructor(e,t){this.name=e;this.predicates=t}extends(e){return new kt(this.name,this.predicates,e)}get typeNames(){return[...new Set([this.name])]}setPredToNode(e){const t=Pt(e);return this._predToNode=t,t}getPredToNode(){let e=this._predToNode;if(!e)e=this.setPredToNode([this]);return e}getAllowedValues(){if(this.allowedValues.size)return this.allowedValues;const e=this.getPredToNode();for(let t in e){const n=e[t];this.allowedValues.add(`${n.name}.${t}`)}return this.allowedValues}get extendedPredicates(){return this.predicates}}class kt extends se{n;_extendedPredicates;_extractedNodes;constructor(e,t,n){super(e,t);this.extendedNodes=n}getPredToNode(){let e=this._predToNode;if(!e){const t=this.extractedNodes;e=this.setPredToNode(t)}return e}get typeNames(){const e=this.extractedNodes;return[...new Set([this.name,...e.map((t)=>t.name)])]}get extractedNodes(){if(!this._extractedNodes)this._extractedNodes=ie([this]);return this._extractedNodes}get extendedPredicates(){if(this._extendedPredicates)return this._extendedPredicates;const t=this.extendedNodes().reduce((n,r)=>{return{...r.extendedPredicates,...n}},{});return this._extendedPredicates={...this.predicates,...t},this._extendedPredicates}}function fo(e=void 0,t=void 0){return{alias:e,asVar:t}}function xo(e,t=void 0,n=void 0){return{pwdVar:e,alias:t,asVar:n}}function yo(e){return{predName:e}}function mo(){return{forward:!0}}function go(e=void 0,t=void 0){return{asCount:!0,alias:e,asVar:t}}function No(e,t,n={}){return{nextNode:e,relation:t,opts:n}}function Po(e){const t=N(1),{filter:n,cascade:r,fragOpts:o,override:i,append:d}=e;let{allowedValues:s,usedVars:p}=o;if(d){if(d.allowedValues)s=new Set([...s,...d.allowedValues]);if(d.usedVars)p=new Map([...p,...d.usedVars.entries()])}if(i){if(i.allowedValues)s=i.allowedValues}function a(u,c,l){const x=R({filter:n,cascade:r},c,l),f=U(e,c,l);let y=`${t}${u}(${f}) ${x}`;if(o)y+=`{\n${o.fragmentStr??o.build()}\n${t}}`;return y}return{build:a,allowedValues:s,usedVars:p,type:void 0}}function Et(e){const t=typeof e;let n="";switch(t){case"number":switch(Number(e)%1){case 0:n="int";break;default:n="float"}break;case"boolean":n="bool";break;default:n="string";break}return n}function $o(e,t={}){const n={},r=new Set,o=[];let i=new Map,d=new Set;for(let a in e){const u=e[a];d=new Set([...d,...u.allowedValues]),i=new Map([...i,...u.usedVars])}for(let a in e){const c=e[a].build(a,i,d);o.push(c)}for(let[a,u]of i){if(a in t)u=t[a];if(u===null||u===void 0)continue;let c=String(u);if(u instanceof Array)c=`[${c}]`;n[a]=c,r.add(`${a}: ${Et(u)}`)}let s="query q",p=Array.from(r);if(r.size)s+=`(${p.join(", ")})`;return s+=`{\n${o.join("\n")}\n}`,{query:s,varDec:p,vars:n,type:void 0}}function $t(e,t,n,r,o,i=2){const d={...t.reduce((p,a)=>{return{...p,...a.getPredToNode()}},{}),...e.getPredToNode()},s=[];for(let p in n){const a=n[p];if(!a)continue;if(p==="uid"||p==="dtype"){let f;if(a instanceof Array)f=a.map((y)=>{if("asCount"in y)return M("uid",y,o,i);return C(p,y,o,i)}).join("\n");else if(typeof a==="object"&&"asCount"in a)f=M("uid",a,o,i);else f=C(p,a,o,i);s.push(f);continue}const u=d[p],l=u.extendedPredicates[p];if(typeof l==="function"){const f=l();let y;if(a instanceof Array)y=a.map((I)=>{if("asCount"in I)return A(u,f,p,I,o,i);return Rt(u,f,p,I,r,o,i)}).join("\n");else if(typeof a==="object"&&"asCount"in a)y=A(u,f,p,a,o,i);else y=Rt(u,f,p,a,r,o,i);s.push(y);continue}let x;if(a instanceof Array)x=a.map((f)=>T(p,l,u,f,r,o,i)).join("\n");else x=T(p,l,u,a,r,o,i);s.push(x)}return s.join("\n")}function Rt(e,t,n,r,o,i,d=2){const s=N(d);if(typeof r==="boolean"){const y=L(e,t,n,i);return`${s}${y}`}const{cascade:p,filter:a,opts:u,order:c,page:l}=r,x=L(e,t,n,i,u?.alias,u?.asVar),f=R({cascade:p,page:l,filter:a,order:c},o,i);return`${s}${x} ${f}`}function It(e){return typeof e==="boolean"?"@recurse":`@recurse(loop: ${e.loop}, depth: ${e.depth})`}function _o(e){const t=N(1),{filter:n,cascade:r,fragOpts:o,recurseOpts:i}=e,{allowedValues:d,usedVars:s}=o;function p(a,u,c){const l=R({filter:n,cascade:r},u,c),x=U(e,u,c);let f=`${t}${a}(${x}) ${l}`;if(i)f+=`${It(i)} `;if(o)f+=`{\n${o.fragmentStr??o.build()}\n${t}}`;return f}return{build:p,allowedValues:d,usedVars:s,type:void 0}}function bo(e,t,n,r=!0){const o=new Map,i=new Set([...e.getAllowedValues(),...t.flatMap((s)=>[...s.getAllowedValues()])]);function d(){return $t(e,t,n,o,i)}return{build:d,fragment:n,type:void 0,fragmentStr:r?d():void 0,usedVars:o,allowedValues:i}}function qo(...e){const t=[];for(let n of e)t.push(nr(n));return t.join("\n")}function nr(e){const t=[],n=[],r=N(1),o=e.extendedPredicates,i=e.getPredToNode();for(let d in o){const s=o[d],p=i[d],a=`${p.name}.${d}`;if(typeof s==="function"){const{nextNode:v,opts:{asArray:h,count:Z,asType:vt},relation:B}=s();if(vt)continue;let _=`${a}: ${h?"[uid]":"uid"}`,z="";if("predName"in B){const J=v.getPredToNode()[B.predName],St=h?`[${J.name}]`:J.name;z=`<~${J.name}.${B.predName}>: ${St}`,_=""}else{const de=h?`[${v.name}]`:v.name;if(z=`${p.name}.${d}: ${de}`,_+=" @reverse ",Z)_+="@count ";_+="."}if(t.push(r+z),p.name===e.name)n.push(_);continue}const u=s,{opts:c}=u,{type:l,asArray:x}=c,f=x?`[${l}]`:l;let y=`${a}: ${f}`;if("indexes"in c){const v=[],{indexes:h}=c;if(typeof h==="boolean")v.push(l);else for(let Z of h)v.push(Z);y+=` @index(${v.join(", ")})`}let I=a;if(p.name!==e.name)y="";if(y.trim().length)y+=" .",n.push(y);t.push(r+I)}return`${n.join("\n")}\ntype ${e.name} {\n${t.join("\n")}\n}\n`}function Wo(e,t){const n=e.getPredToNode(),r=e.extendedPredicates,o={};for(let i in t){const d=r[i],{label:s}=t[i],p=n[i],a=`${p.name}.${i}`;if(typeof d==="function"){const{opts:{count:x}}=d(),f={uid_in:w.uid_in,...x&&{...S,...Q},has:w.has};o[i]={indexes:f,label:s,field:a,nodeName:e.name,jsType:"string",countable:x||!1};continue}const u=d.opts;let c={has:w.has,...rr(u,i,p.name)};const l=or(u);o[i]={indexes:c,label:s,field:a,jsType:l,nodeName:e.name,allowedValues:"allowedValues"in u?u.allowedValues:void 0,countable:!1}}return o.dtype={indexes:{type:w.type},label:"Type",field:"dgraph.type",jsType:"string",nodeName:e.name,countable:!1},o.uid={indexes:{uid:w.uid},label:"ID",field:"uid",jsType:"string",nodeName:e.name,countable:!0},o}var rr=function(e,t,n){if(!("indexes"in e))throw new Error(`Predicate ${String(n)}.${String(t)} must have an index`);let r={};if(typeof e.indexes==="boolean")if(e.type===O.GEO)r={...r,...xt};else r={...r,...yt};else if(e.indexes instanceof Array)if(e.type===O.STRING){const o=e.indexes.reduce((i,d)=>({...i,...k[d]}),{});r={...r,...o}}else{const o=e.indexes.reduce((i,d)=>{return{...i,...ft[d]}},{});r={...r,...o}}return r},or=function(e){if(e.type===O.BOOL)return"boolean";if(e.type===O.DATETIME)return"date";if(e.type===O.FLOAT||e.type===O.INT||e.type===O.GEO)return"number";return"string"};export{qo as schema,yo as reverse,bo as recurseFragment,_o as recurse,$o as queryBlock,Po as query,No as predicateNode,fo as pred,xo as pass,co as node,Dt as mutate,ro as multi,ar as from,no as fragment,mo as forward,Wo as filterablePreds,pr as edge,go as count,nr as buildNode,Hn as ZeroValIndex,ct as ZeroIndexlessOps,Xn as TwoValIndex,pt as TrigramTwoValOps,dt as TrigramOps,it as TermOps,k as StringIndex,Yn as OneValIndex,ot as InequalityTwoValOps,Q as InequalityOps,lt as IndexlessOps,w as Indexless,ur as GoGeomTypes,ut as GeoTwoValOps,at as GeoOps,xt as GeoIndex,st as FullTextOps,S as EqualityOps,O as EdgeType,yt as DefaultIndex,ft as DateTimeIndex,kt as DNodeExtended,se as DNode,ae as DEdge,mt as AllIndexes};

//# debugId=B9C4FC31B6372CE064756e2164756e21
